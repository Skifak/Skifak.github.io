---
title: Почтовый клиент в терминале - Neomutt
tags: TeXt
---

<div class="hero hero hero--dark" style="background-image: url('https://bsod2528.github.io/Pictures/CLI-Diary/Setup.gif');">
    <div class = "hero__content">
    <h3> Neomutt </h3>
    <p> Почтовый клиент в терминале </p>
    </div>
</div>

Начиная рубрику оптимизиции рабочих процессов, хотелось бы рассказать о Neomutt - форк текстового почтового клиента Mutt. Особо вдаватся в подробности Mutt я не буду, скажу лишь только что>

Главная задача Nm заключается в том чтобы быть почтовым агентом пользователя. Функционал этого клиента примерно такой:
- Чтение писем, отправка, архивация и др.
- Подписывание своих писем GPG-ключем
- Поддержка протоколов: POP3, IMAP - для получения почты и SMTP - для её отправки 
- Подключение нескольких аккаунтов
- Безопасность аккаунта пользователя с помощью технологий PGP
- Привязки клавиш, макросы клавиатуры, почтовые потоки и т.д.

Это далеко не все возможности Nm и чтобы узнать о них больше для начала установим его.

# Установка
Я буду производить установку и настройку в Arch. Установка на разные системы отличается, но настройка самого Nm одинакова для всех.
## Linux

Arch:
``` 
$ pacman -S neomutt
```
Debian:
```
$ apt-get install neomutt
```
Homebrew:
```
$ brew install neomutt
```
Процесс установки для других систем можно посмотреть на [официальном сайте NM](https://neomutt.org/distro)
## Windows
Установка доступна в виде пакета [Cygwin](https://cygwin.com/install.html). для его установки возьмите последнюю версию установки Cygwin и выберите пакет NeoMutt.


## MacOS
Чтобы установить neomutt в MacOS у вас должен быть установлен [MacPorts](https://www.macports.org/install.php).
```
$ sudo port install neomutt
```

# Начальная настройка почты
Для примера добавим возможность читать письма с Gmail. Для начала немного настроим наш ящик.

Перемещаемся в наш почтовый ящик, нажимаем на настройки в открывшемся окне нажимаем на "Все настройки"
![1](https://i.ibb.co/CHN2zPF/1.png)
Далее нажимаем на вкладку "Пересылка и POP/IMAP" > Доступ по протоколу IMAP: Включить IMAP > Сохраняем изменения.
![2](https://i.ibb.co/gTM1xKN/2.png)

На этом настройка ящика закончена.
# Конфигурация
Переходим к конфигурации Nm. Для начала нам нужно создать файл конфигурации

```bash
$ cd ~
$ mkdir .mutt
$ cd .mutt/
$ vim .neomuttrc
```
Теперь запишем пару основных настроек для подключения IMAP и SMTP.
>Я не буду вдаваться в подробности настроки для каждой учетной записи, п�тому что заставить neomutt действительно общаться с вашим почтовым сервером — это совсем другое дело, для которого >

### Настройка IMAP: 
```bash
set imap_user="user@example.com"
set imap_pass="pass"
set folder=imaps://imap.gmail.com:993
set spoolfile=+INBOX
set editor = "vim"
```
В folder указываем IMAP-сервер почты, а в spoolfile — каталог с почтой на этом сервере. Editor указывает на то, какой редактор будет использоваться внутри Nm.

Что бы периодически проверять все каталоги — указываем:
```
set imap_check_subscribed
```

Для кеширования данных локальных, что бы не тянуть данные каждый раз с сервера добавляем:

```
set header_cache = ~/.cache/mutt
set message_cachedir = ~/.cache/mutt
```

### Настройка SMPT
Для отправки почты c поддержкой [SSL](https://ru.wikipedia.org/wiki/SSL) из Nm указываем:

```
set smtp_pass = "pass"
set smtp_url=smtps://useraddress@smtp.gmail.com:465
set ssl_force_tls = yes

set realname = "name"
set from = "user@example.com"
set use_from = yes
```


Начальная настройка завершена. Сохраняем и закрываем редактор и заходим в Nm.
![3](https://i.ibb.co/PYwrLjf/3.png)
Небольшая шпаргалка по Nm

Главное меню:
- q: выход из просмотра ил  программы
- d: отметить на удаление (будет удалено при выходе)
- m: создать новое письмо
- r: ответить на текущее

При просмотре письма:
- i: вернуться к списку писем в ящике
- пробел: следующая страница текста
- -: предыдщая страница письма
- r: ответить
- d: удалить
- стрелки вверх/вниз/влево/вправо: следующее/предыдущее письмо

# Безопасность
При создании конфигурации мы создали огромную дыру в безопасности нашей почты. 
На мой взгляд хранить пароль от почты в открытом виде - опасно. Давайте это исправим.

Для доступа к почте внутри Nm я буду использовать GPG-ключи.
Создадим файл для хранения пароля
```bash
$ cd .mutt/
$ vim passwords
```

со следующим содержимым

```bash
set imap_pass="password"
set smtp_pass="password"
```
Просто вписываем свои пароли

Далее с помощью GPG зашифруем этот файл

Если у вас нет GPG-ключей - придется обзавестись
```bash
$ gpg --gen-key
```
После создание ключей переходим непосредственно к шифрованию


```bash
$ gpg -r your.email@example.com -e ~/.mutt/passwords
$ ls ~/.mutt/passwords*
/home/user/.mutt/passwords   /home/user/.mutt/passwords.gpg
$ shred ~/.mutt/passwords
$ rm ~/.mutt/passwords
```
Теперь заменим smtp_pass и imap_pass в файле `.neomuttrc` на 

```
source "gpg -d ~/.mutt/passwords.gpg |"
```
